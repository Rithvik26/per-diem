{
  "info": {
    "name": "Per Diem API",
    "description": "Restaurant menu API backed by Square Catalog API\n\n## Setup\n1. Import this collection into Postman\n2. Create an environment with variables:\n   - `BASE_URL`: http://localhost:3001\n   - `LOCATION_ID`: Your Square location ID (e.g., LJ67PB3JFBKFB)\n\n## Endpoints\n- GET /health - Health check\n- GET /api/locations - List all active Square locations\n- GET /api/catalog/categories - List categories for a location\n- GET /api/catalog - Full menu with items grouped by category\n- POST /webhooks/square/catalog-updated - Square webhook for cache invalidation",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "per-diem-api"
  },
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/health",
              "host": ["{{BASE_URL}}"],
              "path": ["health"]
            },
            "description": "Returns server health status and current timestamp."
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/health",
                  "host": ["{{BASE_URL}}"],
                  "path": ["health"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"status\": \"ok\",\n  \"timestamp\": \"2024-01-15T10:30:00.000Z\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Locations",
      "item": [
        {
          "name": "List Locations",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/locations",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "locations"]
            },
            "description": "Returns all ACTIVE Square locations.\n\nFeatures:\n- Filtered to only ACTIVE status locations\n- Cached for 5 minutes\n- Transforms Square Address format to simplified structure"
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/locations",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "locations"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"locations\": [\n    {\n      \"id\": \"LH2KND9QN1SHY\",\n      \"name\": \"Default Test Account\",\n      \"address\": {\n        \"address_line_1\": \"1455 Market St\",\n        \"locality\": \"San Francisco\",\n        \"administrative_district_level_1\": \"CA\",\n        \"postal_code\": \"94103\"\n      },\n      \"timezone\": \"America/Los_Angeles\",\n      \"status\": \"ACTIVE\"\n    }\n  ]\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Categories",
      "item": [
        {
          "name": "List Categories",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/catalog/categories?location_id={{LOCATION_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "catalog", "categories"],
              "query": [
                {
                  "key": "location_id",
                  "value": "{{LOCATION_ID}}",
                  "description": "Square location ID (required)"
                }
              ]
            },
            "description": "Returns categories with item counts for a specific location.\n\nFeatures:\n- Filters items to only those present at the specified location\n- Joins category names from Square related_objects\n- Counts items per category\n- Sorted alphabetically by category name\n- Cached for 5 minutes per location\n\nQuery Parameters:\n- `location_id` (required): Square location ID"
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/catalog/categories?location_id={{LOCATION_ID}}",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "catalog", "categories"],
                  "query": [
                    {
                      "key": "location_id",
                      "value": "{{LOCATION_ID}}"
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"categories\": [\n    {\n      \"id\": \"CAT_BURGERS\",\n      \"name\": \"Burgers\",\n      \"item_count\": 3\n    },\n    {\n      \"id\": \"CAT_PIZZA\",\n      \"name\": \"Pizza\",\n      \"item_count\": 5\n    },\n    {\n      \"id\": \"CAT_DRINKS\",\n      \"name\": \"Drinks\",\n      \"item_count\": 8\n    }\n  ]\n}"
            },
            {
              "name": "Missing location_id",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/catalog/categories",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "catalog", "categories"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Validation failed\",\n    \"details\": [\n      {\n        \"field\": \"location_id\",\n        \"message\": \"location_id is required\"\n      }\n    ]\n  },\n  \"timestamp\": \"2024-01-15T10:30:00.000Z\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Catalog",
      "item": [
        {
          "name": "Get Full Catalog",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/catalog?location_id={{LOCATION_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "catalog"],
              "query": [
                {
                  "key": "location_id",
                  "value": "{{LOCATION_ID}}",
                  "description": "Square location ID (required)"
                }
              ]
            },
            "description": "Returns full catalog with items grouped by category for a specific location.\n\nProcess:\n1. Fetches ALL catalog items from Square (handles pagination automatically)\n2. Includes related_objects (categories, images, variations) via Square API\n3. Filters items to only those present at the specified location\n4. For each item:\n   - Joins category_id → category name from related_objects\n   - Joins image_ids[0] → image URL from related_objects\n   - Extracts variations with formatted prices\n5. Groups items by category name\n6. Sorts categories alphabetically\n7. Caches for 5 minutes per location\n\nQuery Parameters:\n- `location_id` (required): Square location ID"
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/catalog?location_id={{LOCATION_ID}}",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "catalog"],
                  "query": [
                    {
                      "key": "location_id",
                      "value": "{{LOCATION_ID}}"
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"categories\": [\n    {\n      \"category\": \"Burgers\",\n      \"categoryId\": \"CAT_BURGERS\",\n      \"items\": [\n        {\n          \"id\": \"ITEM_BURGER_1\",\n          \"name\": \"Cheeseburger\",\n          \"description\": \"Juicy beef patty with cheese, lettuce, tomato, and our special sauce\",\n          \"category\": \"Burgers\",\n          \"image_url\": \"https://square-catalog-images.s3.amazonaws.com/burger.jpg\",\n          \"variations\": [\n            {\n              \"id\": \"VAR_BURGER_REGULAR\",\n              \"name\": \"Regular\",\n              \"priceDollars\": 9.95,\n              \"priceFormatted\": \"$9.95\"\n            },\n            {\n              \"id\": \"VAR_BURGER_DOUBLE\",\n              \"name\": \"Double\",\n              \"priceDollars\": 13.95,\n              \"priceFormatted\": \"$13.95\"\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"category\": \"Pizza\",\n      \"categoryId\": \"CAT_PIZZA\",\n      \"items\": [\n        {\n          \"id\": \"ITEM_PIZZA_1\",\n          \"name\": \"Margherita Pizza\",\n          \"description\": \"Classic Italian pizza with fresh mozzarella, tomato, and basil\",\n          \"category\": \"Pizza\",\n          \"image_url\": \"https://square-catalog-images.s3.amazonaws.com/pizza.jpg\",\n          \"variations\": [\n            {\n              \"id\": \"VAR_PIZZA_SMALL\",\n              \"name\": \"Small\",\n              \"priceDollars\": 12.5,\n              \"priceFormatted\": \"$12.50\"\n            },\n            {\n              \"id\": \"VAR_PIZZA_LARGE\",\n              \"name\": \"Large\",\n              \"priceDollars\": 18.5,\n              \"priceFormatted\": \"$18.50\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}"
            },
            {
              "name": "Empty Catalog",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/catalog?location_id={{LOCATION_ID}}",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "catalog"],
                  "query": [
                    {
                      "key": "location_id",
                      "value": "{{LOCATION_ID}}"
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"categories\": []\n}"
            },
            {
              "name": "Missing location_id",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{BASE_URL}}/api/catalog",
                  "host": ["{{BASE_URL}}"],
                  "path": ["api", "catalog"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Validation failed\",\n    \"details\": [\n      {\n        \"field\": \"location_id\",\n        \"message\": \"location_id is required\"\n      }\n    ]\n  },\n  \"timestamp\": \"2024-01-15T10:30:00.000Z\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Webhooks",
      "item": [
        {
          "name": "Square Catalog Updated",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"merchant_id\": \"MERCHANT123\",\n  \"type\": \"catalog.version.updated\",\n  \"event_id\": \"abc123\",\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"data\": {\n    \"type\": \"catalog\",\n    \"id\": \"CATALOG_VERSION_456\",\n    \"object\": {\n      \"catalog_version\": {\n        \"updated_at\": \"2024-01-15T10:30:00Z\"\n      }\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/webhooks/square/catalog-updated",
              "host": ["{{BASE_URL}}"],
              "path": ["webhooks", "square", "catalog-updated"]
            },
            "description": "Square webhook endpoint for catalog updates.\n\nWhen Square sends a `catalog.version.updated` event:\n1. Clears all catalog:* caches\n2. Clears all categories:* caches\n3. Returns 200 OK with cache invalidation confirmation\n\nFor other event types:\n- Returns 200 OK without cache invalidation\n\nNote: In production, validate Square webhook signature."
          },
          "response": [
            {
              "name": "Catalog Updated",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"merchant_id\": \"MERCHANT123\",\n  \"type\": \"catalog.version.updated\",\n  \"event_id\": \"abc123\",\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"data\": {\n    \"type\": \"catalog\",\n    \"id\": \"CATALOG_VERSION_456\",\n    \"object\": {}\n  }\n}"
                },
                "url": {
                  "raw": "{{BASE_URL}}/webhooks/square/catalog-updated",
                  "host": ["{{BASE_URL}}"],
                  "path": ["webhooks", "square", "catalog-updated"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"message\": \"Webhook processed\",\n  \"caches_cleared\": [\n    \"catalog:*\",\n    \"categories:*\"\n  ]\n}"
            },
            {
              "name": "Other Event Type",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"merchant_id\": \"MERCHANT123\",\n  \"type\": \"payment.created\",\n  \"event_id\": \"xyz789\",\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"data\": {\n    \"type\": \"payment\",\n    \"id\": \"PAYMENT_123\",\n    \"object\": {}\n  }\n}"
                },
                "url": {
                  "raw": "{{BASE_URL}}/webhooks/square/catalog-updated",
                  "host": ["{{BASE_URL}}"],
                  "path": ["webhooks", "square", "catalog-updated"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"message\": \"Webhook received\",\n  \"event_id\": \"xyz789\"\n}"
            }
          ]
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:3001",
      "type": "default"
    },
    {
      "key": "LOCATION_ID",
      "value": "LJ67PB3JFBKFB",
      "type": "default"
    }
  ]
}
